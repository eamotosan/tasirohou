<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>負荷テストサイト</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        input, button {
            margin: 5px;
        }
        #results {
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <h1>シンプル田代砲</h1>
    <label for="url">テストするURL:</label>
    <input type="text" id="url" placeholder="https://example.com">
    <p></p>
    <label for="requestCount">リクエスト数:</label>
    <input type="number" id="requestCount" value="100" min="1">
    
    <button id="startTest">負荷テスト開始</button>
    
    <div id="results"></div>

    <script>
        document.getElementById('startTest').addEventListener('click', function() {
            let requestCount = parseInt(document.getElementById('requestCount').value);
            let url = document.getElementById('url').value;
            let resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = ''; // 結果をクリア

            if (!url) {
                resultsDiv.innerHTML = '<p>URLを入力してください。</p>';
                return;
            }

            let startTime = performance.now();
            let promises = [];

            for (let i = 0; i < requestCount; i++) {
                promises.push(sendRequest(url));
            }

            Promise.all(promises).then((responses) => {
                let endTime = performance.now();
                let duration = endTime - startTime;
                resultsDiv.innerHTML = `<p>${requestCount} 件のリクエストを送信しました。所要時間: ${duration.toFixed(2)} ms</p>`;
            }).catch(err => {
                resultsDiv.innerHTML = `<p>エラー: ${err}</p>`;
            });
        });

        function sendRequest(url) {
            return new Promise((resolve, reject) => {
                fetch(url, { method: 'GET' })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Network response was not ok');
                        }
                        resolve(response);
                    })
                    .catch(err => reject(err));
            });
        }
    </script>
</body>
    <p>簡易的な田代砲を作ってみました</p>
    <p>シンプルだから意外と使いやすいかも</p>
    <p>バグがあったらごめんなさい</p>
</html>
